<!DOCTYPE html>
<html lang="ja">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <meta name="viewport" content="width=320">

    <head>
        <link rel="stylesheet" href="style.css">
        <script type="text/javascript" src="jquery-2.1.3.min.js"></script>

    </head>
    <body>
        <div>
            抽選曲数
            <input type="number"
                id="selectCount"
                value="4"
                min = "1"
                max = "99"
            >
        </div>
        <div>
            <input type="checkbox" id="isSquence" name="isSquence" value="1">
            <label for="isSquence">連番出力</label>
        </div>

        <div id="main">
        </div>
        <br>
        <div class="buttonDiv">
            <button onclick="select();">抽選</button>
        </div>

        <script type="text/javascript">
            data = [];
            var main = document.getElementById("main");
            count = 0;

            outputColumns = ["title", "product", "category", "artist", "year"];

            function select()
            {
                count += 1;

                var h1 = document.createElement("h1");
                h1.innerHTML = count;
                main.appendChild(h1);

                var selectCount;
                var batchCount;
                if ($("#isSquence").prop('checked'))
                {
                    selectCount = 1;;
                    batchCount = Number($("#selectCount").val());
                }
                else
                {
                    selectCount = Number($("#selectCount").val());
                    batchCount = 1;
                }

                for(var i=0 ; i<selectCount; ++i)
                {
                    var batchIndex = Math.floor(Math.random() * (data.length - (batchCount-1)));
                    var batch = data.splice(batchIndex, batchCount)

                    for(var j=0 ; j<batch.length ; ++j)
                    {
                        var record = batch[j];

                        var h = document.createElement("h4");
                        h.innerHTML = record["title"];
                        main.appendChild(h);

                        var str = "";

                        if (record["year"])
                        {
                            str += record["year"];
                        }
                        if (record["product"])
                        {
                            str += "　" + record["product"];
                        }
                        if (record["category"])
                        {
                            str += " " + record["category"];
                        }
                        if (record["artist"])
                        {
                            str += "　" + record["artist"];
                        }
                        var p = document.createElement("p");
                        p.className = "song";
                        main.appendChild(p);
                        p.innerHTML = str;
                    }
                }
                var hr = document.createElement("hr");
                main.appendChild(hr);
            }

            function concatJson(json)
            {
                Array.prototype.push.apply(data, json);
            }
        </script>

        <!-- ここから曲データベース -->
        <script type="text/javascript" src="json.txt"></script>
        <!-- ここまで曲データベース -->

        <script type="text/javascript">
            var p = document.createElement("p");
            p.innerHTML = "現在" + data.length + "曲登録";
            document.getElementById("main").appendChild(p);
        </script>
    </body>
<html>


